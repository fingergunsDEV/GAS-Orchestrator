<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAS ORCHESTRATOR // NEURAL</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body class="h-screen"> 

    <!-- VUE APP CONTAINER -->
    <div id="app" class="h-full flex flex-col p-4 gap-4" :class="{'is-processing': isProcessing}">

      <!-- INFRASTRUCTURE LAYERS -->
      <canvas id="neural-canvas"></canvas>
      <div class="hex-overlay"></div>

      <!-- BOOT OVERLAY -->
      <div class="boot-overlay" v-if="booting">
        <div class="font-hud text-3xl text-cyan-400 tracking-[0.5em] mb-8 animate-pulse">UPLINKING</div>
        <div class="flex gap-1 mb-4">
          <div v-for="n in 5" :key="n" 
               class="w-8 h-1 transition-all duration-300"
               :style="{ backgroundColor: bootProgress >= (n*20) ? '#00f3ff' : '#111' }"></div>
        </div>
        <div class="font-code text-[10px] text-gray-600 uppercase tracking-widest">{{ bootStatus }}</div>
      </div>

      <!-- MAIN INTERFACE -->
      <div class="flex-1 flex flex-col h-full max-w-[1600px] mx-auto w-full gap-4 relative z-10" v-show="!booting">

        <!-- TOP HUD -->
        <header class="flex justify-between items-start py-2">
          <div class="flex items-center gap-4">
            <div class="relative">
              <div class="w-12 h-12 lux-panel flex items-center justify-center rounded-sm border-2" :style="{borderColor: uiColor}">
                <span class="font-hud font-bold text-xl" :style="{color: uiColor}">Ω</span>
              </div>
              <div class="absolute -top-1 -right-1 w-3 h-3 bg-red-600 rounded-full animate-ping opacity-75" v-if="isProcessing"></div>
            </div>
            <div>
              <h1 class="text-3xl font-hud tracking-tighter text-white">CORE_<span :style="{color: uiColor}">ORCHESTRATOR</span></h1>
              <div class="text-[9px] font-code text-gray-500 tracking-[0.4em] uppercase">Neural Interface Layer // V2.5</div>
            </div>
          </div>

          <div class="grid grid-cols-3 gap-8 text-right font-code text-[10px]">
            <div>
              <div class="text-gray-600">CONNECTION</div>
              <div :style="{color: isConnected ? '#22c55e' : '#ef4444'}">{{ isConnected ? 'STABLE' : 'LOST' }}</div>
            </div>
            <div>
              <div class="text-gray-600">THREAT_LEVEL</div>
              <div class="text-blue-400">MINIMAL</div>
            </div>
            <div>
              <div class="text-gray-600">LOCAL_TIME</div>
              <div class="text-white">{{ currentTime }}</div>
            </div>
          </div>
        </header>

        <!-- MAIN LAYOUT -->
        <div class="flex-1 grid grid-cols-12 gap-4 min-h-0">

          <!-- PRIMARY TERMINAL -->
          <div class="col-span-5 flex flex-col gap-4 min-h-0">
            <div class="lux-panel rounded-sm flex-1 p-6 flex flex-col min-h-0 overflow-hidden">
              <div class="corner-l"></div><div class="corner-r"></div>
              
              <div class="overflow-y-auto flex-1 flex flex-col gap-6 pr-2 font-raj">
                <div v-if="chatHistory.length === 0" class="flex flex-col items-center justify-center h-full opacity-20">
                  <div class="text-6xl mb-4">⌬</div>
                  <div class="font-hud tracking-widest text-xs">READY FOR DIRECTIVE</div>
                </div>
                
                <transition-group name="fade">
                  <div v-for="(msg, i) in chatHistory" :key="i" class="flex flex-col">
                    <div class="text-[9px] font-hud uppercase tracking-widest mb-2 opacity-40" 
                         :class="msg.role === 'user' ? 'text-right' : 'text-left'">{{ msg.role }}</div>
                    <div class="p-4 text-sm leading-relaxed relative"
                         :class="msg.role === 'user' ? 'bg-white/5 border-r-2 border-cyan-500 self-end text-right ml-12' : 'bg-white/5 border-l-2 border-amber-500 mr-12'">
                      {{ msg.text }}
                    </div>
                  </div>
                </transition-group>

                <div v-if="isProcessing" class="flex items-center gap-3 text-amber-500 font-code text-[10px]">
                  <span class="w-1 h-1 bg-amber-500 rounded-full animate-ping"></span>
                  NEURAL_PROCESSING_IN_PROGRESS...
                </div>
              </div>
            </div>

            <!-- INPUT NODE -->
            <div class="lux-panel rounded-sm p-2">
              <div v-if="selectedImage" class="bg-white/5 p-2 mb-2 flex justify-between items-center border-b border-white/10">
                <span class="text-[10px] font-code text-cyan-400">{{ selectedImage.name }}</span>
                <button @click="clearImage" class="text-red-500 text-lg">&times;</button>
              </div>
              <div class="flex items-center gap-2">
                <label class="p-3 hover:bg-white/5 cursor-pointer transition-colors group">
                  <svg class="w-5 h-5 text-gray-500 group-hover:text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  <input type="file" ref="fileInput" @change="handleFileSelect" accept="image/*" class="hidden">
                </label>
                <input type="text" v-model="userInput" @keyup.enter="sendMessage" 
                       class="flex-1 bg-transparent border-none outline-none text-white font-code text-sm" 
                       placeholder="AWAITING INPUT...">
                <button @click="sendMessage" :disabled="isProcessing"
                        class="px-6 py-3 font-hud text-[10px] tracking-widest border transition-all"
                        :style="{ borderColor: uiColor, color: uiColor, backgroundColor: isProcessing ? 'transparent' : 'rgba(0,243,255,0.05)' }">
                  ENGAGE
                </button>
              </div>
            </div>
          </div>

          <!-- TELEMETRY HUD -->
          <div class="col-span-7 flex flex-col gap-4 min-h-0">
            
            <div class="grid grid-cols-2 gap-4 h-64">
              <!-- AGENT STATUS -->
              <div class="lux-panel p-6 flex flex-col justify-between">
                <div class="text-[10px] font-hud text-gray-600 tracking-widest flex justify-between">
                  <span>AGENT_MATRIX</span>
                  <span :style="{color: uiColor}">{{ activeState.status || 'STBY' }}</span>
                </div>
                <div class="py-4">
                  <div class="text-4xl font-hud text-white truncate">{{ activeState.team || 'OFFLINE' }}</div>
                  <div class="text-xs font-code mt-2" :style="{color: uiColor}">IDENT: {{ activeState.agent || 'NULL' }}</div>
                </div>
                <div class="w-full bg-white/5 h-1 relative overflow-hidden">
                  <div class="gauge-bar" :style="{ width: progressWidth + '%', backgroundColor: uiColor }"></div>
                </div>
              </div>

              <!-- ANALYTICS -->
              <div class="lux-panel p-6 flex flex-col justify-between">
                <div class="text-[10px] font-hud text-gray-600 tracking-widest">NEURAL_LOAD</div>
                <div class="flex-1 flex items-end gap-1 pb-4">
                  <div v-for="n in 20" :key="n" 
                       class="flex-1 bg-cyan-500/20"
                       :style="{ height: (isProcessing ? Math.random()*80 + 20 : 10) + '%', backgroundColor: uiColor, opacity: Math.random() }"></div>
                </div>
                <div class="text-[9px] font-code text-gray-500 truncate">{{ activeState.details || 'Neural pathways clear.' }}</div>
              </div>
            </div>

            <!-- SYSTEM LOGS -->
            <div class="lux-panel flex-1 flex flex-col min-h-0">
              <div class="bg-white/5 p-2 px-4 border-b border-white/10 flex justify-between items-center">
                <span class="text-[9px] font-hud text-gray-500 tracking-[0.2em]">KERNEL_EVENT_STREAM</span>
                <span class="text-[9px] font-code text-cyan-500">SESSION_LIVE</span>
              </div>
              <div class="flex-1 overflow-y-auto p-4 font-code text-[10px] space-y-2" ref="logBox">
                <div v-for="(log, i) in eventLogs" :key="i" class="flex gap-4 opacity-70 hover:opacity-100 transition-opacity">
                  <span class="text-gray-600">{{ log.time }}</span>
                  <span class="font-bold uppercase w-24" :style="{color: getLogColor(log.type)}">{{ log.source }}</span>
                  <span class="text-gray-300">>> {{ log.message }}</span>
                </div>
              </div>
            </div>

          </div>

        </div>
      </div>
    </div> <!-- END APP -->

    <!-- Load App Logic -->
    <script src="script.js"></script>
</body>
</html>
